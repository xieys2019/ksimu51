/***************************************************************************
*   Copyright (C) 2008 by Heikki Pulkkinen   *
*   heikki@localhost   *
*                                                                         *
*   This program is free software; you can redistribute it and/or modify  *
*   it under the terms of the GNU General Public License as published by  *
*   the Free Software Foundation; either version 2 of the License, or     *
*   (at your option) any later version.                                   *
*                                                                         *
*   This program is distributed in the hope that it will be useful,       *
*   but WITHOUT ANY WARRANTY; without even the implied warranty of        *
*   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the         *
*   GNU General Public License for more details.                          *
*                                                                         *
*   You should have received a copy of the GNU General Public License     *
*   along with this program; if not, write to the                         *
*   Free Software Foundation, Inc.,                                       *
*   59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.             *
***************************************************************************/
#include "Latch8W.h"
#include "Logic74C.h"


Latch8W::Latch8W(QWidget* parent, char const * name, int wflags, unsigned int const  componentNumber, unsigned int const  componentType) : Logic74BaseW(parent, name, wflags, componentNumber, componentType)
{
	using namespace Latch8W_NameS;
	
	componentName_+=" Octal D-type Latch";
	delayTimeTyp_=DELAYTIME;

	loadComponentXPMImage();
	componentImageQLabel_->setPixmap(componentImage_);

	//Input pins
	addInputPin(PINNAME_EN);
	addInputPin(PINNAME_C1);
	addInputPin(PINNAME_D0);
	addInputPin(PINNAME_D1);
	addInputPin(PINNAME_D2);
	addInputPin(PINNAME_D3);
	addInputPin(PINNAME_D4);
	addInputPin(PINNAME_D5);
	addInputPin(PINNAME_D6);
	addInputPin(PINNAME_D7);
	addOutputPin(PINNAME_Q0);
	addOutputPin(PINNAME_Q1);
	addOutputPin(PINNAME_Q2);
	addOutputPin(PINNAME_Q3);
	addOutputPin(PINNAME_Q4);
	addOutputPin(PINNAME_Q5);
	addOutputPin(PINNAME_Q6);
	addOutputPin(PINNAME_Q7);

	pToENPin_=ioList_.pToPin(PINNAME_EN);
	pToDPin_=ioList_.pToPin(PINNAME_C1);
	pToD0Pin_=ioList_.pToPin(PINNAME_D0);
	pToQ0Pin_=ioList_.pToPin(PINNAME_Q0);

	initW(); //

}

Latch8W::~Latch8W()
{

}

void Latch8W::execute_VirtualPart_ExecuteInputChange_ExecutionReady_VirtualPart(void)
{
	//Lähdöt seuraa inputtia
	if(pToDPin_->readValue(true))
	{
		IOPin* inP=pToD0Pin_;
		IOPin* outP=pToQ0Pin_;
		for(int n=0; n<8; n++)
		{
			outP->writeValue(inP->readValue(true), true);
			inP=inP->next();
			outP=outP->next();
		}
	}

	//Lähdöt hiz tilaan jos EN = 1
	IOPin* outP=pToQ0Pin_;
	for(int n=0; n<8; n++)
	{
		outP->setHizState(pToENPin_->readValue(true));
		outP=outP->next();
	}
}

void Latch8W::loadComponentXPMImage(void)
{
	/* XPM */
	static char const * logicXPM[]={
	"116 190 2 1",
	"# c #a54b4b",
	". c #ffffff",
	"....................................................................................................................",
	".................###################################################................................................",
	".................#.................................................#................................................",
	".................#.................................................#................................................",
	".................#.................................................#................................................",
	".................#.................................................#................................................",
	".................#.................................................#................................................",
	"........##.......#.................................................#................................................",
	"........#.##.....#.................................................#................................................",
	"........#...##...#.................................................#................................................",
	"........#.....##.#....#####.#...#..................................#................................................",
	"##################....#.....##..#..................................#......................####.....#################",
	".................#....#.....##..#..................................#......................####....##................",
	".................#....#####.#.#.#..................................#......................####...##.................",
	".................#....#.....#.#.#..................................#......................####..##..................",
	".................#....#.....#..##..................................#......................####.##...................",
	".................#....#####.#...#..................................#......................######....................",
	".................#.................................................#......................#####.....................",
	".................#.................................................#......................####......................",
	".................#.................................................#......................####......................",
	".................#.................................................#......................####......................",
	".................#.................................................#......................####......................",
	".................#.................................................#......................####......................",
	".................#.................................................#......................####......................",
	".................#....####....#....................................#......................####......................",
	"##################...##...#..##....................................#......................####......................",
	".................#...#........#....................................#......................####......................",
	".................#...#........#....................................#......................####......................",
	".................#...#....#...#....................................#......................####......................",
	".................#...##...#...#....................................#......................####.....#################",
	".................#....####....#....................................#......................####....##................",
	".................#.................................................#......................####...##.................",
	".................#########.................................#########......................####..##..................",
	".........................#.................................#..............................####.##...................",
	".........................#.................................#..............................######....................",
	".........................#.................................#..............................#####.....................",
	".........................#.................................#..............................####......................",
	".........................#.................................#..............................####......................",
	".................###################################################......................####......................",
	".................#.................................................#......................####......................",
	".................#.................................................#......................####......................",
	".................#.................................................#.....................#####......................",
	".................#.................................................#....................######......................",
	".................#.................................................#...................##.####......................",
	".................#.................................................#..................##..####......................",
	".................#.....#..####.........#.................#######...#.................##...####......................",
	".................#....##..#...#........###................#....#...#................##....####......................",
	"##################.....#..#...#........#..##..............#...#....##################.....####.....#################",
	".................#.....#..#...#........#....##.............#..#....#......................####....##................",
	".................#.....#..#...#........#...##..............#.#.....#......................####...##.................",
	".................#.....#..#...#........#.##.................##.....#......................####..##..................",
	".................#.....#..####.........##...................#......#......................####.##...................",
	".................#.................................................#......................######....................",
	".................#.................................................#......................#####.....................",
	".................#.................................................#......................####......................",
	".................#.................................................#......................####......................",
	".................###################################################......................####......................",
	".................#.................................................#......................####......................",
	".................#.................................................#......................####......................",
	".................#.................................................#.....................#####......................",
	".................#.................................................#....................######......................",
	".................#.................................................#...................##.####......................",
	".................#.................................................#..................##..####......................",
	".................#.................................................#.................##...####......................",
	".................#.................................................#................##....####......................",
	"##################.................................................##################.....####.....#################",
	".................#.................................................#......................####....##................",
	".................#.................................................#......................####...##.................",
	".................#.................................................#......................####..##..................",
	".................#.................................................#......................####.##...................",
	".................#.................................................#......................######....................",
	".................#.................................................#......................#####.....................",
	".................#.................................................#......................####......................",
	".................#.................................................#......................####......................",
	".................###################################################......................####......................",
	".................#.................................................#......................####......................",
	".................#.................................................#......................####......................",
	".................#.................................................#.....................#####......................",
	".................#.................................................#....................######......................",
	".................#.................................................#...................##.####......................",
	".................#.................................................#..................##..####......................",
	".................#.................................................#.................##...####......................",
	".................#.................................................#................##....####......................",
	"##################.................................................##################.....####.....#################",
	".................#.................................................#......................####....##................",
	".................#.................................................#......................####...##.................",
	".................#.................................................#......................####..##..................",
	".................#.................................................#......................####.##...................",
	".................#.................................................#......................######....................",
	".................#.................................................#......................#####.....................",
	".................#.................................................#......................####......................",
	".................#.................................................#......................####......................",
	".................#.................................................#......................####......................",
	".................###################################################......................####......................",
	".................#.................................................#......................####......................",
	".................#.................................................#.....................#####......................",
	".................#.................................................#....................######......................",
	".................#.................................................#...................##.####......................",
	".................#.................................................#..................##..####......................",
	".................#.................................................#.................##...####......................",
	".................#.................................................#................##....####......................",
	"##################.................................................##################.....####.....#################",
	".................#.................................................#......................####....##................",
	".................#.................................................#......................####...##.................",
	".................#.................................................#......................####..##..................",
	".................#.................................................#......................####.##...................",
	".................#.................................................#......................######....................",
	".................#.................................................#......................#####.....................",
	".................#.................................................#......................####......................",
	".................#.................................................#......................####......................",
	".................#.................................................#......................####......................",
	".................###################################################......................####......................",
	".................#.................................................#......................####......................",
	".................#.................................................#.....................#####......................",
	".................#.................................................#....................######......................",
	".................#.................................................#...................##.####......................",
	".................#.................................................#..................##..####......................",
	".................#.................................................#.................##...####......................",
	".................#.................................................#................##....####......................",
	"##################.................................................##################.....####.....#################",
	".................#.................................................#......................####....##................",
	".................#.................................................#......................####...##.................",
	".................#.................................................#......................####..##..................",
	".................#.................................................#......................####.##...................",
	".................#.................................................#......................######....................",
	".................#.................................................#......................#####.....................",
	".................#.................................................#......................####......................",
	".................#.................................................#......................####......................",
	".................#.................................................#......................####......................",
	".................###################################################......................####......................",
	".................#.................................................#......................####......................",
	".................#.................................................#.....................#####......................",
	".................#.................................................#....................######......................",
	".................#.................................................#...................##.####......................",
	".................#.................................................#..................##..####......................",
	".................#.................................................#.................##...####......................",
	".................#.................................................#................##....####......................",
	"##################.................................................##################.....####.....#################",
	".................#.................................................#......................####....##................",
	".................#.................................................#......................####...##.................",
	".................#.................................................#......................####..##..................",
	".................#.................................................#......................####.##...................",
	".................#.................................................#......................######....................",
	".................#.................................................#......................#####.....................",
	".................#.................................................#......................####......................",
	".................#.................................................#......................####......................",
	".................#.................................................#......................####......................",
	".................###################################################......................####......................",
	".................#.................................................#......................####......................",
	".................#.................................................#.....................#####......................",
	".................#.................................................#....................######......................",
	".................#.................................................#...................##.####......................",
	".................#.................................................#..................##..####......................",
	".................#.................................................#.................##...####......................",
	".................#.................................................#................##....####......................",
	"##################.................................................##################.....####......................",
	".................#.................................................#......................####......................",
	".................#.................................................#......................####......................",
	".................#.................................................#......................####......................",
	".................#.................................................#......................####......................",
	".................#.................................................#......................####......................",
	".................#.................................................#......................####......................",
	".................#.................................................#......................####......................",
	".................#.................................................#......................####......................",
	".................#.................................................#......................####......................",
	".................###################################################......................####......................",
	".................#.................................................#......................####......................",
	".................#.................................................#.....................#####......................",
	".................#.................................................#....................######......................",
	".................#.................................................#...................##.####......................",
	".................#.................................................#..................##..####......................",
	".................#.................................................#.................##...####......................",
	".................#.................................................#................##....####......................",
	"##################.................................................##################.....####......................",
	".................#.................................................#................................................",
	".................#.................................................#................................................",
	".................#.................................................#................................................",
	".................#.................................................#................................................",
	".................#.................................................#................................................",
	".................#.................................................#................................................",
	".................#.................................................#................................................",
	".................#.................................................#................................................",
	".................#.................................................#................................................",
	".................###################################################................................................",
	"....................................................................................................................",
	"....................................................................................................................",
	"....................................................................................................................",
	"....................................................................................................................",
	"....................................................................................................................",
	"...................................................................................................................."
	};

	componentImage_=QPixmap(logicXPM);

}

