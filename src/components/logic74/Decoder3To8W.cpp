/***************************************************************************
*   Copyright (C) 2008 by Heikki Pulkkinen   *
*   heikki@localhost   *
*                                                                         *
*   This program is free software; you can redistribute it and/or modify  *
*   it under the terms of the GNU General Public License as published by  *
*   the Free Software Foundation; either version 2 of the License, or     *
*   (at your option) any later version.                                   *
*                                                                         *
*   This program is distributed in the hope that it will be useful,       *
*   but WITHOUT ANY WARRANTY; without even the implied warranty of        *
*   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the         *
*   GNU General Public License for more details.                          *
*                                                                         *
*   You should have received a copy of the GNU General Public License     *
*   along with this program; if not, write to the                         *
*   Free Software Foundation, Inc.,                                       *
*   59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.             *
***************************************************************************/
#include "Decoder3To8W.h"

Decoder3To8W::Decoder3To8W(QWidget* parent, char const * name, int wflags, unsigned int const  componentNumber, unsigned int const  componentType) : Logic74BaseW(parent, name, wflags, componentNumber, componentType)
{
	componentName_+=" 3-Line to 8-Line Decoder";
	delayTimeTyp_=DELAYTIME;

	loadComponentXPMImage();
	componentImageQLabel_->setPixmap(componentImage_);

	//Input pins
	addInputPin(PINNAME_A);
	addInputPin(PINNAME_B);
	addInputPin(PINNAME_C);
	addInputPin(PINNAME_G1);
	addInputPin(PINNAME_G2A);
	addInputPin(PINNAME_G2B);
	addOutputPin(PINNAME_Y0);
	addOutputPin(PINNAME_Y1);
	addOutputPin(PINNAME_Y2);
	addOutputPin(PINNAME_Y3);
	addOutputPin(PINNAME_Y4);
	addOutputPin(PINNAME_Y5);
	addOutputPin(PINNAME_Y6);
	addOutputPin(PINNAME_Y7);

	pToAPin_=ioList_.pToPin(PINNAME_A);
	pToG1Pin_=ioList_.pToPin(PINNAME_G1);
	pToG2APin_=ioList_.pToPin(PINNAME_G2A);
	pToG2BPin_=ioList_.pToPin(PINNAME_G2B);
	pToY0Pin_=ioList_.pToPin(PINNAME_Y0);

	initW(); //
}

Decoder3To8W::~Decoder3To8W()
{

}

void Decoder3To8W::execute_VirtualPart_ExecuteInputChange_ExecutionReady_VirtualPart(void)
{
	int outNum=0;
	IOPin* apuPToPin=pToAPin_;
	//Haetaan aktiivinen lähtö
	for(int n=0; n<3; n++)
	{
		if(apuPToPin->readValue(true))
			outNum|=8;//00001000 ->>>
		outNum>>=1;
		apuPToPin=apuPToPin->next();
	}
	//Käydään kaikki lähdöt lävitse
	apuPToPin=pToY0Pin_;
	for(int n=0; n<8; n++)
	{
		apuPToPin->writeValue(true, true); //Lähtö on high, ellei seuraavat ehdot täyty.
		if(outNum==n)
		{
			if(pToG1Pin_->readValue(true) && !pToG2APin_->readValue(true) && !pToG2BPin_->readValue(true))
				apuPToPin->writeValue(false, true);
		}
		apuPToPin=apuPToPin->next();
	}
}

void Decoder3To8W::loadComponentXPMImage(void)
{
	/* XPM */
	static char const * logicXPM[]={
"141 190 2 1",
"# c #a54b4b",
". c #ffffff",
".............................................................................................................................................",
".............................................................................................................................................",
".............................................................................................................................................",
"..................................................#########################################################################..................",
"..................................................#.......................................................................#..................",
"..................................................#........#..............#####..##...##.#...#..#...#.....................#..................",
"..................................................#.........#.............#...##.##...##.#...#..#..#......................#..................",
"..................................................#..........#............#....#.##...##.#...#...##.......................###................",
"..................................................#...........#...........#....#.#.#.#.#.#...#....#.......................#..##..............",
"..................................................#............#..........#....#.#.#.#.#.#...#...#.#..............###.....#....##............",
"..................................................#.....###.....#.........#...##.#.#.#.#.#...#..#..#.............#...#....#......##..........",
"###################################################....#...#....#.........#####..#..#..#..###...#...#............#...#....###################",
"..................................................#....#...#....#................................................#...#....#..................",
"..................................................#....#...#....#................................................#...#....#..................",
"..................................................#....#...#....#................................................#...#....#..................",
"..................................................#....#...#....#.................................................###.....#..................",
"..................................................#.....###.....#.........................................................#..................",
"..................................................#.............#.........................................................#..................",
"..................................................#.............#.........................................................#..................",
"..................................................#.............#.........................................................#..................",
"..................................................#.............#.........................................................#..................",
"..................................................#.............#.........................................................#..................",
"..................................................#.............#.........................................................#..................",
"..................................................#.............#.........................................................#..................",
"..................................................#.............#.........................................................#..................",
"..................................................#.............#.........................................................###................",
"..................................................#.............#...............###.......................................#..##..............",
"..................................................#.............#..............#...#.................................#....#....##............",
"..................................................#.............#..............#...#...............................###....#......##..........",
"###################################################..............#.............#...#.................................#....###################",
"..................................................#...............#............#...#.................................#....#..................",
"..................................................#..............#.............#...#.................................#....#..................",
"..................................................#.............#.......####....###..................................#....#..................",
"..................................................#.............#......#....#........................................#....#..................",
"..................................................#.............#.....#...................................................#..................",
"..................................................#.............#.....#...###.............................................#..................",
"..................................................#.............#.....#.....#...####......................................#..................",
"..................................................#.............#......#....#.............................................#..................",
"..................................................#.............#.......#####.............................................#..................",
"..................................................#.............#..............#####......................................#..................",
"..................................................#.............#.................#.......................................#..................",
"..................................................#.............#.................#.......................................#..................",
"..................................................#.............#................#........................................#..................",
"..................................................#.............#................#........................................###................",
"..................................................#.............#...............#.........................................#..##..............",
"..................................................#.............#...............#.................................###.....#....##............",
"..................................................#.....###.....#................................................#...#....#......##..........",
"###################################################....#...#....#....................................................#....###################",
"..................................................#........#....#...................................................#.....#..................",
"..................................................#.......#.....#.................................................##......#..................",
"..................................................#.....##......#................................................#........#..................",
"..................................................#....#.......#.................................................#####....#..................",
"..................................................#....#####..#...........................................................#..................",
"..................................................#..........#............................................................#..................",
"..................................................#.........#.............................................................#..................",
"..................................................#........#..............................................................#..................",
"..................................................#.......................................................................#..................",
"..................................................#.......................................................................#..................",
"..................................................#.......................................................................#..................",
"..................................................#.......................................................................#..................",
"..................................................#.......................................................................#..................",
"..................................................#.......................................................................###................",
"..................................................#.......................................................................#..##..............",
"..................................................#.......................................................................#....##............",
"..................................................#...............................................................###.....#......##..........",
"#################################.................#...............................................................#..#....###################",
"................................#.................#..................................................................#....#..................",
"................................#.................#................................................................##.....#..................",
"................................#.................#..................................................................#....#..................",
"................................#.................#..................................................................#....#..................",
"................................#.................#...............................................................###.....#..................",
"................................#.................#.......................................................................#..................",
"................................#.................#.......................................................................#..................",
"................................#.................#.......................................................................#..................",
"................................#.................#.......................................................................#..................",
"................................#.................#.......................................................................#..................",
"................................#.................#.......................................................................#..................",
"................................#.................#.......................................................................#..................",
"................................#.................#.......................................................................#..................",
"................................#.................########################................................................##.................",
"................................#.................#......................#................................................#.##...............",
"................................#.................#......................#................................................#...##.............",
"................................#.................#......................#..........................................#.....#.....##...........",
"######################..........#.................#......................#.........................................##.....###################",
".....................#..........#.................#..........###.........#........................................#.#.....#..................",
".....................#..........#.................#.........#..#.........#.......................................#..#.....#..................",
".....................#..........#.................#.........####.........#.......................................#####....#..................",
".....................#..........#.................#.........###..........#..........................................#.....#..................",
".....................#..........###################........#..###........#..........................................#.....#..................",
".....................#............................#........#...##........#................................................#..................",
".....................#............................#.........###.#........#................................................#..................",
".....................#............................#......................#................................................#..................",
".....................#............................#......................#................................................#..................",
".....................#............................#......................#................................................#..................",
".....................#............................#......................#................................................#..................",
".....................#............................#......................#................................................#..................",
".....................#............................#......................#................................................#..................",
".....................#............................#......................#................................................##.................",
".....................#............................#......................#................................................#.##...............",
".....................#............................#......................#................................................#...##.............",
".....................#............................#......................#........................................####....#.....##...........",
"############.........#............................#......................#........................................#.......###################",
"...........#.........#...................##.......#......................#........................................###.....#..................",
"...........#.........#...................#.##.....#......................#.......................................#...#....#..................",
"...........#.........#...................#...##...#......................#...........................................#....#..................",
"...........#.........#...................#.....##.#......................#.......................................#...#....#..................",
"...........#.........##############################......................#........................................###.....#..................",
"...........#......................................#......................#................................................#..................",
"...........#......................................#......................#................................................#..................",
"...........#......................................#......................#................................................#..................",
"...........#......................................#......................#................................................#..................",
"...........#......................................#......................#................................................#..................",
"...........#......................................#......................#................................................#..................",
"...........#......................................#......................#................................................#..................",
"...........#......................................#......................#................................................#..................",
"...........#......................................#......................#................................................##.................",
"...........#......................................#......................#................................................#.##...............",
"...........#......................................#......................#................................................#...##.............",
"...........#......................................#......................#........................................###.....#.....##...........",
"...........#......................................#......................#.......................................#...#....###################",
"...........#.............................##.......#......................#.......................................#........#..................",
"...........#.............................#.##.....#......................#.......................................####.....#..................",
"...........#.............................#...##...#......................#.......................................#...#....#..................",
"...........#.............................#.....##.#......................#.......................................#...#....#..................",
"...........########################################......................#........................................###.....#..................",
"..................................................#......................#................................................#..................",
"..................................................#......................#................................................#..................",
"..................................................#......................#................................................#..................",
"..................................................#......................#................................................#..................",
"..................................................#......................#................................................#..................",
"..................................................#......................#................................................#..................",
"..................................................#......................#................................................#..................",
"..................................................#......................#................................................#..................",
"..................................................#......................#................................................##.................",
"..................................................#......................#................................................#.##...............",
"..................................................#......................#................................................#...##.............",
"..................................................#......................#.......................................#####....#.....##...........",
"..................................................#......................#..........................................#.....###################",
"..................................................#......................#..........................................#.....#..................",
"..................................................#......................#.........................................#......#..................",
"..................................................#......................#.........................................#......#..................",
"..................................................#......................#........................................#.......#..................",
"..................................................#......................#........................................#.......#..................",
"..................................................#......................#................................................#..................",
"..................................................#########################################################################..................",
".............................................................................................................................................",
".............................................................................................................................................",
".............................................................................................................................................",
".............................................................................................................................................",
".............................................................................................................................................",
".............................................................................................................................................",
".............................................................................................................................................",
".............................................................................................................................................",
".............................................................................................................................................",
".............................................................................................................................................",
".............................................................................................................................................",
".............................................................................................................................................",
".............................................................................................................................................",
".............................................................................................................................................",
".............................................................................................................................................",
".............................................................................................................................................",
".............................................................................................................................................",
".............................................................................................................................................",
".............................................................................................................................................",
".............................................................................................................................................",
".............................................................................................................................................",
".............................................................................................................................................",
".............................................................................................................................................",
".............................................................................................................................................",
".............................................................................................................................................",
".............................................................................................................................................",
".............................................................................................................................................",
".............................................................................................................................................",
".............................................................................................................................................",
".............................................................................................................................................",
".............................................................................................................................................",
".............................................................................................................................................",
".............................................................................................................................................",
".............................................................................................................................................",
".............................................................................................................................................",
".............................................................................................................................................",
".............................................................................................................................................",
".............................................................................................................................................",
".............................................................................................................................................",
".............................................................................................................................................",
".............................................................................................................................................",
".............................................................................................................................................",
".............................................................................................................................................",
".............................................................................................................................................",
"............................................................................................................................................."   };

	componentImage_=QPixmap(logicXPM);

}

